<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>M-Gacha Carnival</title>
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background: url("assets/background.png") no-repeat center center fixed;
      background-size: cover;
      text-align: center;
      color: white;
    }

    #logo {
      width: 120px;
      margin: 15px auto 5px;
    }

    .info-bar {
      margin: 10px 0;
      font-size: 20px;
    }

    .info-bar img {
      width: 20px;
      vertical-align: middle;
      margin-right: 5px;
    }

    .menu {
      position: absolute;
      top: 20px;
      right: 20px;
    }

    .menu button {
      background: white;
      color: black;
      border: none;
      border-radius: 10px;
      padding: 10px;
      font-weight: bold;
      cursor: pointer;
      margin-left: 10px;
    }

    #gift-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      justify-content: center;
      max-width: 400px;
      margin: 20px auto;
    }

    .gift-box {
      width: 100px;
      height: 100px;
      background: url("assets/gift-box.png") no-repeat center;
      background-size: contain;
      cursor: pointer;
    }

    #reward-popup, #reward-list, #history-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.9);
      padding: 20px;
      border-radius: 15px;
      z-index: 10;
      display: none;
    }

    #reward-popup button, #reward-list button, #history-popup button {
      margin-top: 15px;
      padding: 8px 20px;
      border: none;
      background: yellow;
      color: black;
      font-weight: bold;
      cursor: pointer;
      border-radius: 8px;
    }

    .blur {
      filter: blur(4px);
    }
  </style>
</head>
<body>
  <img src="assets/logo-mandiri.png" id="logo" />

  <div class="menu">
    <button onclick="showRewardList()">üéÅ Daftar Hadiah</button>
    <button onclick="showHistory()">üìú HadiahMu</button>
  </div>

  <div class="info-bar">
    <div><img src="assets/coin.png" alt="coin"/> <span id="point-display">M-Gacha Poin: 10</span></div>
    <div id="chance-display">Kesempatan Hari ini: 0x</div>
    <div style="font-size:14px; margin-top:4px;">Tukarkan 2 poin untuk 1x kesempatan</div>
  </div>

  <div id="gift-container"></div>

  <div id="reward-popup"></div>
  <div id="reward-list">
    <h3>üéÅ Daftar Hadiah</h3>
    <ul style="text-align:left;">
      <li>+3 M-Gacha Poin</li>
      <li>i-Voucher Indomaret Rp 50.000</li>
      <li>i-Voucher Indomaret Rp 100.000</li>
      <li>Voucher Alfamart Rp 50.000</li>
      <li>Voucher Alfamart Rp 100.000</li>
      <li>Voucher Grab Rp 50.000</li>
      <li>Iphone 15 128GB</li>
      <li>Samsung Smart TV 32"</li>
      <li>Honda Vario 125 CBS ISS</li>
      <li>Logam Mulia 1gr</li>
    </ul>
    <button onclick="closeRewardList()">Tutup</button>
  </div>

  <div id="history-popup">
    <h3>üìú HadiahMu</h3>
    <ul id="history-list" style="text-align:left;"></ul>
    <button onclick="closeHistory()">Tutup</button>
  </div>

  <audio id="sound" src="assets/arcade-sound.mp3"></audio>

  <script>
    let points = 10;
    let chances = 0;
    const history = [];

    const rewards = [
      ...Array(98).fill('+3 M-Gacha Poin'),
      'i-Voucher Indomaret Rp 50.000',
      'i-Voucher Indomaret Rp 100.000',
      'Voucher Alfamart Rp 50.000',
      'Voucher Alfamart Rp 100.000',
      'Voucher Grab Rp 50.000',
      'Iphone 15 128GB',
      'Samsung Smart TV 32"',
      'Honda Vario 125 CBS ISS',
      'Logam Mulia 1gr'
    ];

    const giftContainer = document.getElementById("gift-container");
    const pointDisplay = document.getElementById("point-display");
    const chanceDisplay = document.getElementById("chance-display");
    const rewardPopup = document.getElementById("reward-popup");
    const sound = document.getElementById("sound");

    function updateDisplay() {
      pointDisplay.innerHTML = `M-Gacha Poin: ${points}`;
      chanceDisplay.innerHTML = `Kesempatan Hari ini: ${10 - chances}x`;
    }

    function createGiftBox(i) {
      const box = document.createElement("div");
      box.className = "gift-box";
      box.onclick = () => {
        if (chances >= 10 || points < 2) {
          alert("Kamu kehabisan kesempatan atau poin.");
          return;
        }

        sound.play();
        chances++;
        points -= 2;

        const reward = rewards[Math.floor(Math.random() * rewards.length)];
        history.push(reward);
        updateDisplay();
        showRewardPopup(reward);
        sendToGoogleSheets(reward);
      };
      return box;
    }

    function renderGifts() {
      giftContainer.innerHTML = "";
      for (let i = 0; i < 4; i++) {
        giftContainer.appendChild(createGiftBox(i));
      }
    }

    function showRewardPopup(reward) {
      rewardPopup.innerHTML = `
        <div style="font-size:20px;">üéâ Kamu mendapat: <b>${reward}</b></div>
        <br><button onclick="closeRewardPopup()">Main Lagi</button>
      `;
      rewardPopup.style.display = "block";
    }

    function closeRewardPopup() {
      rewardPopup.style.display = "none";
    }

    function showRewardList() {
      document.getElementById("reward-list").style.display = "block";
    }

    function closeRewardList() {
      document.getElementById("reward-list").style.display = "none";
    }

    function showHistory() {
      const list = document.getElementById("history-list");
      list.innerHTML = "";
      history.forEach((item, idx) => {
        const li = document.createElement("li");
        li.innerText = `${idx + 1}. ${item}`;
        list.appendChild(li);
      });
      document.getElementById("history-popup").style.display = "block";
    }

    function closeHistory() {
      document.getElementById("history-popup").style.display = "none";
    }

    function sendToGoogleSheets(reward) {
      const data = {
        nama: "Demo Nasabah",
        cif: "1234567890",
        norek: "1122334455",
        hp: "081234567890",
        email: "demo@example.com",
        reward: reward
      };

      fetch("https://script.google.com/macros/s/AKfycbwYHTbpOPV0P3qwu06kgDZA3hnNJABi16ofPkBn48kV9cmo_zV-ieSYtbCzBwkooA1P/exec", {
        method: "POST",
        mode: "no-cors",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(data)
      });
    }

    renderGifts();
    updateDisplay();
  </script>
</body>
</html>
