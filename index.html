<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>M-Gacha Carnival</title>
  <style>
    body {
      margin: 0;
      background: url('background.png') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Arial', sans-serif;
      color: white;
      text-align: center;
    }
    .logo { width: 150px; margin: 10px auto; display: block; }
    .info { font-size: 1.2em; margin: 5px; }
    .coin { width: 20px; vertical-align: middle; margin-right: 5px; }
    .gift-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      max-width: 400px;
      margin: 20px auto;
    }
    .gift-box {
      width: 120px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .gift-box:hover { transform: scale(1.1); }
    .button {
      position: fixed;
      top: 10px;
      right: 10px;
      background: white;
      color: black;
      padding: 8px 15px;
      border-radius: 15px;
      font-weight: bold;
      cursor: pointer;
    }
    .button.history { top: 50px; }
    .modal, .overlay {
      display: none;
      position: fixed;
      z-index: 1000;
    }
    .overlay {
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
    }
    .modal {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      color: black;
      padding: 20px;
      border-radius: 12px;
      max-width: 90%;
      text-align: left;
    }
    .modal.show, .overlay.show { display: block; }
    .reward-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%,-50%);
      background: #fff;
      color: #000;
      padding: 30px;
      border-radius: 10px;
      font-size: 20px;
      display: none;
      z-index: 9999;
    }
  </style>
</head>
<body>

  <img src="logo-mandiri.png" class="logo" />
  <div class="info"><img src="coin.png" class="coin" /> <span id="points">M-Gacha Poin: 10</span></div>
  <div class="info">Kesempatan Hari ini: <span id="chances">10x</span></div>
  <div class="info">Tukarkan 2 poin untuk 1x kesempatan</div>

  <div class="gift-container" id="giftContainer"></div>

  <div class="button" onclick="showModal('list')">üìú Daftar Hadiah</div>
  <div class="button history" onclick="showModal('history')">üéÅ HadiahMu</div>

  <div class="overlay" id="overlay" onclick="hideModal()"></div>

  <div class="modal" id="modal-list">
    <h3>üìú Daftar Hadiah</h3>
    <ul>
      <li>+3 M-Gacha Poin</li>
      <li>i-Voucher Indomaret Rp 50.000</li>
      <li>i-Voucher Indomaret Rp 100.000</li>
      <li>Voucher Alfamart Rp 50.000</li>
      <li>Voucher Alfamart Rp 100.000</li>
      <li>Voucher Grab Rp 50.000</li>
      <li>Iphone 15 128GB</li>
      <li>Samsung Smart TV 32"</li>
      <li>Honda Vario 125 CBS ISS</li>
      <li>Logam Mulia 1gr</li>
    </ul>
  </div>

  <div class="modal" id="modal-history">
    <h3>üéÅ HadiahMu</h3>
    <ul id="historyList"></ul>
  </div>

  <div class="reward-popup" id="rewardPopup"></div>

  <audio id="sound" src="arcade-sound.mp3" preload="auto"></audio>

  <script>
    const rewards = [
      ...Array(98).fill("+3 M-Gacha Poin"),
      ...Array(1).fill("i-Voucher Indomaret Rp 50.000"),
      ...Array(1).fill("Voucher Grab Rp 50.000"),
      "Samsung Smart TV 32\"",
      "Honda Vario 125 CBS ISS",
      "Logam Mulia 1gr"
    ];

    let points = 10;
    let chances = 10;
    let history = [];

    const pointsDisplay = document.getElementById("points");
    const chancesDisplay = document.getElementById("chances");
    const giftContainer = document.getElementById("giftContainer");
    const rewardPopup = document.getElementById("rewardPopup");
    const sound = document.getElementById("sound");

    function updateDisplay() {
      pointsDisplay.innerHTML = `M-Gacha Poin: ${points}`;
      chancesDisplay.innerHTML = `${chances}x`;
    }

    function showModal(type) {
      document.getElementById("overlay").classList.add("show");
      document.getElementById("modal-" + type).classList.add("show");
      if (type === 'history') {
        const historyList = document.getElementById("historyList");
        historyList.innerHTML = history.map(item => `<li>${item}</li>`).join("");
      }
    }

    function hideModal() {
      document.getElementById("overlay").classList.remove("show");
      document.querySelectorAll(".modal").forEach(m => m.classList.remove("show"));
    }

    function createGiftBox(index) {
      const img = document.createElement("img");
      img.src = "gift-box.png";
      img.className = "gift-box";
      img.onclick = () => openBox(index);
      return img;
    }

    function openBox(index) {
      if (chances <= 0 || points < 2) {
        alert("Kamu kehabisan kesempatan atau poin.");
        return;
      }

      sound.play();
      chances--;
      points -= 2;
      const reward = rewards[Math.floor(Math.random() * rewards.length)];
      history.push(reward);

      updateDisplay();
     showRewardPopup(reward);
     sendToGoogleSheets(reward);

      
    }
    function sendToGoogleSheets(reward) {
  const data = {
    nama: "Demo Nasabah",
    cif: "1234567890",
    norek: "1122334455",
    hp: "081234567890",
    email: "demo@example.com",
    reward: reward
  };

  fetch("https://script.google.com/macros/s/AKfycbwYHTbpOPV0P3qwu06kgDZA3hnNJABi16ofPkBn48kV9cmo_zV-ieSYtbCzBwkooA1P/exec", {
    method: "POST",
    mode: "no-cors",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(data)
  });
}

    function showRewardPopup(reward) {
      rewardPopup.innerHTML = `<div>üéâ Kamu mendapat: <b>${reward}</b></div><br><button onclick="closeRewardPopup()">Main Lagi</button>`;
      rewardPopup.style.display = "block";
    }

    function closeRewardPopup() {
      rewardPopup.style.display = "none";
    }

    function renderGifts() {
      giftContainer.innerHTML = "";
      for (let i = 0; i < 4; i++) {
        giftContainer.appendChild(createGiftBox(i));
      }
    }

    renderGifts();
    updateDisplay();
  </script>
</body>
</html>
