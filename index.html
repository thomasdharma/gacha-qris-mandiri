<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>M-Gacha Carnival</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: url('assets/background.png') no-repeat center center fixed;
      background-size: cover;
      text-align: center;
      color: white;
    }

    .topbar {
      margin-top: 20px;
    }

    .menu-button {
      background: white;
      color: black;
      padding: 8px 16px;
      border-radius: 12px;
      margin: 5px;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }

    .status {
      font-size: 18px;
      margin: 10px;
    }

    #gift-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      justify-content: center;
      align-items: center;
      max-width: 350px;
      margin: 30px auto;
    }

    .gift-box {
      width: 130px;
      height: 130px;
      background: url('assets/gift-box.png') no-repeat center;
      background-size: contain;
      cursor: pointer;
    }

    .popup, .history-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      color: black;
      padding: 20px;
      border-radius: 12px;
      z-index: 1000;
      display: none;
    }

    .popup button {
      margin-top: 15px;
    }

    .coin {
      width: 20px;
      vertical-align: middle;
      margin-right: 5px;
    }
  </style>
</head>
<body>

  <div class="topbar">
    <button class="menu-button" onclick="showPrizeList()">üéÅ Daftar Hadiah</button>
    <button class="menu-button" onclick="showHistory()">üì¶ HadiahMu</button>
  </div>

  <div class="status">
    <div><img src="assets/coin.png" class="coin"> <b>M-Gacha Poin:</b> <span id="points">10</span></div>
    <div><b>Kesempatan Hari ini:</b> <span id="chances">10x</span></div>
    <div><small>Tukarkan 2 poin untuk 1x kesempatan</small></div>
  </div>

  <div id="gift-container"></div>

  <div class="popup" id="reward-popup"></div>
  <div class="popup" id="prize-popup">
    <h3>üéÅ Daftar Hadiah</h3>
    <ul style="text-align:left">
      <li>+3 M-Gacha Poin</li>
      <li>i-Voucher Indomaret Rp 50.000</li>
      <li>i-Voucher Indomaret Rp 100.000</li>
      <li>Voucher Alfamart Rp 50.000</li>
      <li>Voucher Alfamart Rp 100.000</li>
      <li>Voucher Grab Rp 50.000</li>
      <li>Iphone 15 128GB</li>
      <li>Samsung Smart TV 32‚Äù</li>
      <li>Honda Vario 125 CBS ISS</li>
      <li>Logam Mulia 1gr</li>
    </ul>
    <button onclick="closePrizeList()">Tutup</button>
  </div>

  <div class="popup" id="history-popup">
    <h3>üì¶ HadiahMu</h3>
    <ul id="history-list" style="text-align:left"></ul>
    <button onclick="closeHistory()">Tutup</button>
  </div>

  <audio id="arcade-sound" src="assets/arcade-sound.mp3"></audio>

  <script>
    const rewards = [
      "+3 M-Gacha Poin", "+3 M-Gacha Poin", "+3 M-Gacha Poin", "+3 M-Gacha Poin", "+3 M-Gacha Poin",
      "+3 M-Gacha Poin", "+3 M-Gacha Poin", "+3 M-Gacha Poin", "+3 M-Gacha Poin", "+3 M-Gacha Poin",
      "i-Voucher Indomaret Rp 50.000", "i-Voucher Indomaret Rp 100.000",
      "Voucher Alfamart Rp 50.000", "Voucher Alfamart Rp 100.000",
      "Voucher Grab Rp 50.000", "Iphone 15 128GB",
      "Samsung Smart TV 32‚Äù", "Honda Vario 125 CBS ISS", "Logam Mulia 1gr"
    ];

    let points = 10;
    let chances = 10;
    const giftContainer = document.getElementById("gift-container");
    const rewardPopup = document.getElementById("reward-popup");
    const sound = document.getElementById("arcade-sound");
    const history = [];

    const dummyUser = {
      nama: "Demo User",
      cif: "123456789",
      rekening: "1234567890123456",
      hp: "081234567890",
      email: "demo@example.com"
    };

    const scriptURL = 'https://script.google.com/macros/s/AKfycbwYHTbpOPV0P3qwu06kgDZA3hnNJABi16ofPkBn48kV9cmo_zV-ieSYtbCzBwkooA1P/exec';

    function updateDisplay() {
      document.getElementById("points").textContent = points;
      document.getElementById("chances").textContent = chances + "x";
    }

    function createGiftBox() {
      const box = document.createElement("div");
      box.className = "gift-box";
      box.onclick = () => {
        if (chances <= 0 || points < 2) {
          alert("Kamu kehabisan kesempatan atau poin.");
          return;
        }

        sound.play();
        chances--;
        points -= 2;

        const reward = rewards[Math.floor(Math.random() * rewards.length)];

        if (reward.includes("+3")) points += 3;

        history.push(reward);
        updateDisplay();
        showRewardPopup(reward);
        sendToGoogleSheets(reward);
      };
      return box;
    }

    function renderGifts() {
      giftContainer.innerHTML = '';
      for (let i = 0; i < 4; i++) {
        giftContainer.appendChild(createGiftBox());
      }
    }

    function showRewardPopup(reward) {
      rewardPopup.innerHTML = `
        <div><b>üéâ Kamu mendapat:</b><br><br><span style="font-size: 20px;">${reward}</span></div>
        <br><button onclick="closeRewardPopup()">Main Lagi</button>
      `;
      rewardPopup.style.display = "block";
    }

    function closeRewardPopup() {
      rewardPopup.style.display = "none";
    }

    function showPrizeList() {
      document.getElementById("prize-popup").style.display = "block";
    }

    function closePrizeList() {
      document.getElementById("prize-popup").style.display = "none";
    }

    function showHistory() {
      const list = document.getElementById("history-list");
      list.innerHTML = "";
      history.forEach(item => {
        const li = document.createElement("li");
        li.textContent = item;
        list.appendChild(li);
      });
      document.getElementById("history-popup").style.display = "block";
    }

    function closeHistory() {
      document.getElementById("history-popup").style.display = "none";
    }

    function sendToGoogleSheets(reward) {
      fetch(scriptURL, {
        method: 'POST',
        body: new URLSearchParams({
          timestamp: new Date().toISOString(),
          nama: dummyUser.nama,
          cif: dummyUser.cif,
          rekening: dummyUser.rekening,
          hp: dummyUser.hp,
          email: dummyUser.email,
          reward: reward
        })
      });
    }

    renderGifts();
    updateDisplay();
  </script>
</body>
</html>
