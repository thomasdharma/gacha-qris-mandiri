<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>M-Gacha Carnival</title>
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background: url('assets/background.png') no-repeat center center/cover;
      color: white;
      text-align: center;
    }

    #logo {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      height: 50px;
      z-index: 10;
    }

    #menu {
      margin-top: 80px;
    }

    .button {
      padding: 10px 20px;
      margin: 0 5px;
      border-radius: 12px;
      border: none;
      font-weight: bold;
      background-color: white;
      color: black;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      cursor: pointer;
    }

    #status {
      margin: 20px 0 10px;
      font-size: 20px;
      font-weight: bold;
    }

    #info {
      font-size: 14px;
      margin-bottom: 20px;
    }

    #gift-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      max-width: 400px;
      margin: auto;
    }

    .gift-box {
      width: 100px;
      height: 100px;
      background: url('assets/gift-box.png') no-repeat center/contain;
      cursor: pointer;
      margin: auto;
    }

    #reward-popup {
      position: fixed;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      color: black;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      z-index: 999;
      display: none;
    }

    #coin-icon {
      height: 20px;
      vertical-align: middle;
      margin-right: 5px;
    }
  </style>
</head>
<body>
  <img id="logo" src="assets/logo-mandiri.png" alt="Mandiri Logo">

  <div id="menu">
    <button class="button" onclick="showGiftList()">üéÅ Daftar Hadiah</button>
    <button class="button" onclick="showHistory()">üì¶ HadiahMu</button>
  </div>

  <div id="status">
    <div><img id="coin-icon" src="assets/coin.png" /> M-Gacha Poin: <span id="points">10</span></div>
    <div>Kesempatan Hari ini: <span id="chances">10x</span></div>
  </div>
  <div id="info">Tukarkan 2 poin untuk 1x kesempatan</div>

  <div id="gift-container"></div>

  <div id="reward-popup"></div>

  <script>
    let points = 10;
    let chances = 10;
    let history = [];

    const rewards = [
      ...Array(98).fill("+3 M-Gacha Poin"),
      "i-Voucher Indomaret Rp 50.000",
      "i-Voucher Indomaret Rp 100.000",
      "Voucher Alfamart Rp 50.000",
      "Voucher Alfamart Rp 100.000",
      "Voucher Grab Rp 50.000",
      "Iphone 15 128GB",
      "Samsung Smart TV 32‚Äù",
      "Honda Vario 125 CBS ISS",
      "Logam Mulia 1gr"
    ];

    const coinSound = new Audio("assets/arcade-sound.mp3");

    function updateDisplay() {
      document.getElementById("points").textContent = points;
      document.getElementById("chances").textContent = `${chances}x`;
    }

    function createGiftBox(index) {
      const box = document.createElement("div");
      box.className = "gift-box";
      box.onclick = () => openBox(index);
      return box;
    }

    function renderGifts() {
      const container = document.getElementById("gift-container");
      container.innerHTML = "";
      for (let i = 0; i < 4; i++) {
        container.appendChild(createGiftBox(i));
      }
    }

    function showGiftList() {
      alert(`üéÅ Daftar Hadiah:\n\n+3 M-Gacha Poin\ni-Voucher Indomaret Rp 50.000\ni-Voucher Indomaret Rp 100.000\nVoucher Alfamart Rp 50.000\nVoucher Alfamart Rp 100.000\nVoucher Grab Rp 50.000\nIphone 15 128GB\nSamsung Smart TV 32‚Äù\nHonda Vario 125 CBS ISS\nLogam Mulia 1gr`);
    }

    function showHistory() {
      alert("üéâ HadiahMu:\n\n" + (history.length ? history.join("\n") : "Belum ada hadiah."));
    }

    function openBox(index) {
      if (points < 2 || chances <= 0) {
        alert("Kamu kehabisan kesempatan atau poin.");
        return;
      }

      coinSound.play();
      chances--;
      points -= 2;
      const reward = rewards[Math.floor(Math.random() * rewards.length)];

      if (reward === "+3 M-Gacha Poin") {
        points += 3;
      }

      history.push(reward);
      updateDisplay();
      showRewardPopup(reward);
      sendToSheets(reward);
    }

    function showRewardPopup(reward) {
      const popup = document.getElementById("reward-popup");
      popup.innerHTML = `<h3>üéâ Kamu mendapat:</h3><h2>${reward}</h2><br><button onclick="closeRewardPopup()">Main Lagi</button>`;
      popup.style.display = "block";
    }

    function closeRewardPopup() {
      document.getElementById("reward-popup").style.display = "none";
    }

    function sendToSheets(reward) {
      const payload = {
        timestamp: new Date().toISOString(),
        nama: "Demo Nasabah",
        cif: "1234567890",
        norek: "9000012345678",
        hp: "08123456789",
        email: "demo@email.com",
        reward: reward
      };

      fetch("https://script.google.com/macros/s/AKfycbwYHTbpOPV0P3qwu06kgDZA3hnNJABi16ofPkBn48kV9cmo_zV-ieSYtbCzBwkooA1P/exec", {
        method: "POST",
        body: JSON.stringify(payload),
        headers: {
          "Content-Type": "application/json"
        }
      }).then(res => console.log("‚úÖ Data terkirim ke Sheets"));
    }

    renderGifts();
    updateDisplay();
  </script>
</body>
</html>
